{"version":3,"file":"static/webpack/static\\development\\pages\\_app.js.1ab0ef86fce7da6afbc7.hot-update.js","sources":["webpack:///./services/auth0.js"],"sourcesContent":["import auth0 from 'auth0-js';\r\nimport Cookies from 'js-cookie';\r\n\r\nclass Auth0{\r\n    constructor(){\r\n        this.auth0 = new auth0.WebAuth({\r\n            domain: 'guhaprasaanth.auth0.com',\r\n            clientID: 'pcZ8trYSuvn2qMqE720lSdIPaBQPSHLE', // ClienID from Auth0\r\n            redirectUri : 'http://localhost:4000/callback',\r\n            responseType: 'token id_token',\r\n            scope: 'openid profile'\r\n        });\r\n\r\n        this.login = this.login.bind(this);\r\n        this.handleAuthentication = this.handleAuthentication.bind(this);\r\n        this.logout = this.logout.bind(this);\r\n        this.isAuthenticated = this.isAuthenticated.bind(this);\r\n    }\r\n\r\n    handleAuthentication(){\r\n        return new Promise((resolve, reject) => {\r\n            this.auth0.parseHash((err, authResult) => { //parseHash() will parse the hash in the url and returns authResult\r\n                // using the authResult returned by parseHash, it can be determined if the user is logged in or not\r\n                if( authResult && authResult.accessToken && authResult.idToken ){\r\n                    this.setSession(authResult);\r\n                    resolve();\r\n                } else if(err){\r\n                    reject(err);\r\n                    console.log(err);\r\n                }\r\n            });\r\n        });\r\n    }\r\n    \r\n    setSession(authResult){\r\n        debugger;\r\n        // Set the Token expiration time\r\n        const expiresAt = JSON.stringify((authResult.expiresIn * 1000) + new Date().getTime());\r\n        // localStorage.setItem('access_token', authResult.accessToken);\r\n\r\n        Cookies.set('user', authResult.idTokenPayload);\r\n        Cookies.set('jwt', authResult.idToken);\r\n        Cookies.set('expiresAt', expiresAt);\r\n    }\r\n\r\n    logout(){\r\n        Cookies.remove('user');\r\n        Cookies.remove('jwt');\r\n        Cookies.remove('expiresAt');\r\n\r\n        this.auth0.logout({\r\n            returnTo: '',\r\n            clientID: 'pcZ8trYSuvn2qMqE720lSdIPaBQPSHLE'\r\n        })\r\n    }\r\n    \r\n    login(){\r\n        this.auth0.authorize();\r\n    }\r\n\r\n    isAuthenticated(){ // fn() to check if the current time is past the Access Token's expiry time\r\n\r\n        const expiresAt = Cookies.getJSON('expiresAt');\r\n        return new Date().getTime() < expiresAt;\r\n    }\r\n\r\n    clientAuth(){\r\n        return this.isAuthenticated();\r\n    }\r\n\r\n    serverAuth(req){ //The request obj(req) is available in the server side from the prop 'ctx' passed into getInitialProps()\r\n    // The cookies on the server may be found in the request obj\r\n        if(req.headers.cookie){\r\n            const expiresAtCookie = req.headers.cookie.split(';').find(c => c.trim().startsWith('expiresAt='));\r\n\r\n            // const cookies = req.headers.cookie;\r\n            // console.log(\"req.headers.cookie :\",cookies);\r\n            // const splitCookies = cookies.split(';');\r\n            // console.log(\"splitCookies :\",splitCookies);\r\n            // const expiresAtCookie = splitCookies.find( c => c.trim().startsWith('expiresAt='));\r\n            // console.log(\"expiresAtCookies :\",expiresAtCookie);\r\n            // const expiresAtArray = expiresAtCookie.split('=');\r\n            // console.log(\"expiresAtArray :\",expiresAtArray);\r\n            // const expiresAt = expiresAtArray[1];\r\n            // console.log(\"expiresAt : \",expiresAt);\r\n            \r\n\r\n            \r\n            if(!expiresAtCookie) {return undefined}; // Return undefined if the expiresAtCookie is not available\r\n            \r\n            const expiresAt = expiresAtCookie.split('=')[1];// split() => returns array of expiresAt text, where 2nd value'[1]' is date\r\n\r\n            return new Date().getTime() < expiresAt;\r\n\r\n        }\r\n\r\n    }\r\n}\r\n\r\nconst auth0Client = new Auth0();\r\n\r\nexport default auth0Client;"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AALA;AAQA;AACA;AACA;AACA;AACA;AACA;;;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;AAEA;AACA;AACA;AACA;AAEA;AACA;AACA;AAFA;AAIA;;;AAEA;AACA;AACA;;;AAEA;AAAA;AAEA;AACA;AACA;;;AAEA;AACA;AACA;;;AAEA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AAAA;AAAA;AACA;AADA;AACA;AACA;AACA;AACA;AAEA;AAEA;;;;;;AAGA;AAEA;;;;A","sourceRoot":""}